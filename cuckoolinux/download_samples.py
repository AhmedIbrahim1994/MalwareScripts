from bs4 import BeautifulSoup
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
import re
import time
from pyvirtualdisplay import Display

today = time.strftime("%Y-%m-%d")

##------------------------Build The HTML Page --------------------------------- ##


chrome_options = Options()
chrome_options.add_argument('--headless')
chrome_options.add_argument('--no-sandbox')
chrome_options.add_argument('--disable-dev-shm-usage')
chrome_options.add_argument('download.default_directory')

chrome_options.add_experimental_option("prefs",{
  "download.default_directory": "/home/testuser/",
  "download.prompt_for_download": False,
  "download.directory_upgrade": True,
  "safebrowsing.enabled": True
})
driver = webdriver.Chrome("/usr/lib/chromium-browser/chromedriver",chrome_options=chrome_options)




driver.get('https://linux.huntingmalware.com/analysis/')

xpath= '//*[@id="recent"]/tbody/tr[1]/td[4]/a'
##recent > tbody > tr:nth-child(1) > td:nth-child(4) > a

btn = driver.find_element_by_xpath(xpath)
print ("11111")
url = driver.current_url
print (url)

btn.click()

url = driver.current_url
print (url)

print ("22222")


xpath= '//*[@id="file"]/div/div/h4/div/a[1]'
##recent > tbody > tr:nth-child(1) > td:nth-child(4) > a

driver.get(url)
btn = driver.find_element_by_xpath(xpath)
#print (btn)

time.sleep(5)
url = driver.current_url
print (url)


print (btn.click())
time.sleep(5)

url = driver.current_url
print (url)

print ("333333")





#url= driver.current_url
#print (url)


#driver.get(url)


#res = driver.execute_script("return document.documentElement.outerHTML")
#print (res)
#driver.quit()

#soup = BeautifulSoup(res, 'lxml')
#print (soup)
##------------------------Now, The Magic------------------ ##


#table = soup.find('table', {'class': 'table table-striped table-responsive'})

#table= soup.find("tbody")

#tr_list = soup.find_all("tr")

#td_list=[]
#for row in table.find_all("tr")[0:]:
#       td_list.append(row.find_all("td"))

#count = len(td_list)


#print ("Samples Count: ", count)
#print (today)
#for td in range(0, count):
#	id = td_list[td][0].text
#	hash =  td_list[td][2].text
#	date = re.findall("([0-9]{4}\-[0-9]{2}\-[0-9]{2})",td_list[td][1].text)
#	score =  td_list[td][5].text

#	if date[0] == today:
#		#print ("today is: ",today)
#		print ("ID:",id ,"hash:", hash, "++" , "date:", date[0] , "++" , "score" ,score )

