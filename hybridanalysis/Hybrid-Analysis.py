import requests
import sys
import json
import time
import re

from dateutil.parser import parse
headers = {
    'accept': 'application/json',
    'user-agent': 'Falcon Sandbox',
    'api-key': '48wosssk4s4s4k480cskwcssw0cscc0w80k0k8s800sg8k4w4g4sg0k88c88sgkc',
    'Content-Type': 'application/x-www-form-urlencoded',
}

params = (
    ('_timestamp', '1538069978495'),
)

data = {
  'filetype': 'elf'
}

today = time.strftime("%Y-%m-%d")


response = requests.post('https://www.hybrid-analysis.com/api/v2/search/terms', headers=headers, params=params, data=data)
data = response.text

print response.text

datetime = time.strftime("%Y-%m-%d")
filename = "HybridAnalysis"+datetime+".json"

file = open(filename,"w")
file.write(data)
file.close()

with open(filename) as f:
	data = json.load(f)
count = data['count']


for i in range(count):
        #print (data["result"][i]["sha256"])
	sample_date = data["result"][i]["analysis_start_time"]
	
	if sample_date is None:
		#print "No Date"
		continue	
	else:
       		date_obj = parse(sample_date)
	
		if today == date_obj.strftime("%Y-%m-%d"):
			print (date["result"][i]["sha256"])

		else:
			print ("no samples for "+today)
			break
print ("reerrer")






#Save OutPut in a JSON Format
#print "********** SAVE Data Into File"
#datetime = time.strftime("%Y-%m-%d|%H:%M:%S")
#filename = "HybridAnalysis"+datetime+".json"

#print "Save Into File "+filename
#with open(filename,'w') as outfile:
#	json.dump(response.text, outfile)
#print "DONE"
#print "**********"

